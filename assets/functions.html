<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Xerenity Custom Functions</title>

    <!-- ‚úÖ Runtime oficial de Custom Functions -->
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/custom-functions-runtime.js"></script>

    <!-- ‚úÖ Tu c√≥digo de funciones -->
    <script src="https://avelezx.github.io/add-in/assets/functions.js"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 1em;
      }
      h2 {
        color: #0078d4;
      }
      p {
        margin-top: 0.5em;
        color: #333;
      }
    </style>
  </head>
  <body>
    <h2>‚úÖ Runtime host de funciones personalizadas Xerenity</h2>
    <p>El complemento est√° cargado. Puedes cerrar este panel si lo deseas.</p>

    <script>
      console.log("üîÑ Inicializando entorno Xerenity Custom Functions...");

      Office.onReady(() => {
        console.log("‚úÖ Office.onReady ejecutado.");
        // Intentar cargar metadata (opcional)
        fetch("https://avelezx.github.io/add-in/assets/custom-functions.json")
          .then(r => r.json())
          .then(meta => console.log("üìò Metadata cargada:", meta))
          .catch(err => console.warn("‚ö†Ô∏è No se pudo cargar metadata:", err));
      });

      // üß© Forzar activaci√≥n del runtime en Excel local si no est√° activo
      if (typeof CustomFunctions === "undefined") {
        console.warn("‚ö†Ô∏è CustomFunctions runtime no activo. Intentando inicializar manualmente...");
        if (Office && Office.addin) {
          Office.addin.setStartupBehavior(Office.StartupBehavior.load);
        }

        Office.onReady(() => {
          console.log("üß© Intentando activar CustomFunctions en entorno local...");
          try {
            import("https://appsforoffice.microsoft.com/lib/1/hosted/custom-functions-runtime.js")
              .then(() => console.log("‚úÖ Runtime cargado manualmente."))
              .catch(err => console.error("‚ùå Error al cargar runtime manualmente:", err));
          } catch (e) {
            console.error("‚ùå No se pudo inicializar manualmente:", e);
          }
        });
      } else {
        console.log("‚úÖ CustomFunctions runtime activo y listo.");
      }
    </script>
  </body>
</html>